---
title: ワークフロー活動のデバッグ (Common Data Service) | Microsoft Docs
description: プラグイン登録ツールを使用して、ワークフロー活動をデバッグする方法を説明します。
ms.custom: ''
ms.date: 10/31/2018
ms.reviewer: ''
ms.service: powerapps
ms.topic: article
author: JimDaly
ms.author: jdaly
manager: ryjones
search.audienceType:
  - developer
search.app:
  - PowerApps
  - D365CE
---
# <a name="debug-workflow-activities"></a>ワークフロー活動のデバッグ

カスタム ワークフロー拡張機能は .NET フレームワーク アセンブリなので、プラグインをデバッグする方法と非常によく似た方法でデバッグできます。 

## <a name="use-the-plug-in-registration-tool"></a>プラグイン登録ツールを使用する

プラグイン登録ツール (PRT) は、NuGet からダウンロードできるツールの 1 つです。 詳細については、[NuGet からツールをダウンロードする](../download-tools-nuget.md)を参照してください。

PRT をダウンロードしたら、`PluginRegistration.exe` を選択して実行します。

## <a name="install-profiler"></a>プロファイラーをインストールする

PRT からプラグイン プロファイラー ソリューションをインストールするには、**プロファイラーをインストールする**ボタンをクリックします。

![プラグイン登録ツールのインストール プロファイラー ボタン](../media/tutorial-debug-plug-in-install-profiler.md.png)

プラグイン プロファイラーは、自分の環境にインストールできるソリューションで、プラグインの実行コンテキストを取り込み、そのデータを使用してデバッグ中に Visual Studio 内でイベントを再生することができます。

Common Data Service インスタンスに **プラグイン プロファイラー** をインストールすると、**登録済みプラグインとユーザー定義のワークフロー活動** リストの最下部にある PRT に表示されます。

![プラグイン登録ツールを使用したプラグインの登録](media/Plug-in-Profiler.png)

## <a name="profile-a-workflow-activity"></a>ワークフロー活動のプロファイル

ワークフロー活動をプロファイルするには、**プラグイン プロファイラー**を右クリックし、**ワークフロー プロファイリングの開始**を選択します。

![ワークフロー プロファイリングの開始](media/Start-profiling-workflow.png)

これにより、**プロファイラー設定**ダイアログが開き、次のオプションが表示されます。

![プロファイラー設定ダイアログ](media/profiler-settings.png)

|フィールド|説明|
|--|--|
|**ワークフロー**|デバッグするワークフロー活動を含むワークフローまたはカスタム アクションを選択します。|
|**手順**|デバッグするワークフローまたはカスタム アクション内の具体的な手順を選択します。|
|**プロファイル ストレージを指定する**|**エンティティに保持**を選択することをお勧めします。|
|**プロファイラー設定の設定**|ワークフローが頻繁に実行されているシステムで作業している場合、取り込まれるプロファイルの数を制限することで、パフォーマンスへの影響を減らすことができます。|
|**セキュリティで保護された構成を含む**|これにより、セキュリティで保護された構成として渡される可能性のある重要なデータを見ることを避けるオプションが提供されます。|

**OK** をクリックして、設定を保存します。

> [!NOTE]
> このドキュメントの執筆時点では、次のエラーが表示されることがあります。
> 
> ![ワークフロー活動プロファイラー設定を設定する際のエラー](media/error-setting-profiler-settings-workflow-activity.png)
> 
> このエラーの詳細情報には、`Automatic workflow cannot be published if no activation parameters have been specified.` というメッセージが含まれます。
> 
> プロファイルの設定が正常に保存されました。 このエラーは、カスタム ワークフロー活動をプロファイリングするプロセスによってワークフローのコピーが作成され、元のワークフローとコピーの両方が無効になるために発生します。 プロファイルされたコピーを再構成し、それをアクティブ化してプロファイルを取り込む必要があります。  詳しくは、次の手順をご覧ください。

## <a name="capture-a-profile"></a>プロファイルを取り込む

カスタム ワークフロー活動を含むワークフローのプロファイルが構成されると、元のワークフローのコピーが作成され、その名前にテキスト `(Profiled)` が追加されます。 元のワークフローとコピーの両方が非アクティブ化されます。

> [!NOTE]
> システム**既定**のソリューションで作業している場合を除き、コピーされたワークフローはそのソリューションに追加されているため、表示されることはありません。 作業中のソリューションにコピーしたワークフローを表示するには、**既存の追加**をクリックしてこのコピーをソリューションに追加する必要があります。

非アクティブ化されたワークフローは次のように表示されます。

![ソリューション エクスプローラーのコピーされたワークフロー](media/copied-workflow-solution-explorer.png)

ワークフローがコピーされると、構成の一部が失われます。 コピーしたワークフローをアクティブ化しようとすると、次のエラーが発生します: `An automatic process cannot be activated if no activation parameters have been specified. Add activation parameters, and then activate. ...`

つまり、ワークフローのプロパティの**開始時**を再構成する必要があります。 この場合、**アカウント名**フィールドが変更されたときにワークフローを開始するように設定します。

![フィールドが設定を変更したときに開始する](media/start-when-field-changes.png)

**選択**ボタンをクリックし、**アカウント名**フィールドを設定します。

![フィールドがフィールド選択ダイアログ設定を変更したときに開始する](media/start-when-field-change-field-select-dialog.png)

コピーされたプロファイル ワークフローは、バックグラウンド (非同期) ワークフローにも変更されます。 リアルタイム (同期) ワークフローをテストする方が簡単なので、メニュー バーで**リアルタイム ワークフローに変換**をクリックしてください。

コピーされたプロファイル ワークフローを保存し、アクティブ化します。

Common Data Service のインスタンスに接続されているアプリで、もしくは Web サービスを使用して、アカウント エンティティの **アカウント名** の値を更新します。 これにより、カスタム ワークフロー活動に渡されたコンテキストのインスタンスが取り込まれ、システムのプロファイル レコードとして保持されます。

> [!TIP]
> ワークフローが非同期の場合は、完了したことを確認してから次の手順に進みます。 設定 > システム ジョブに移動して、ワークフローが成功していることを確認します。

## <a name="stop-profiling"></a>プロファイリングの停止

デバッグする必要のあるプロファイルを取り込んだ後、プラグインのプロファイリングを停止する必要があります。  

プロファイリングを停止するには、PRT を使用してワークフローの登録を解除します。

![ワークフロー プロファイリングの停止](media/stop-profiling.png)

これにより、作成されたワークフローのコピーが削除されます。

> [!IMPORTANT]
> コピーされたワークフローは引き続き非アクティブ化されます。 それを適用するには、手動で再アクティブ化する必要があります。

## <a name="debug-your-assembly"></a>アセンブリをデバッグする

1. PRT で、**プラグイン実行の再生**をクリックします。
1. **プラグイン実行の再生ダイアログ**の**セットアップ** タブで、ダウンロード ボタンをクリックして**プロファイル**を選択します。

    ![プラグイン実行の再生ダイアログ](media/replay-plugin-execution-dialog.png)

    > [!NOTE]
    > **セキュリティで保護されていない構成**、**セキュリティで保護された構成**、および**設定**タブは、ワークフロー活動のデバッグには使用されません。 これらはプラグインでのみ使用されます。

1. **CRM からプロファイルを選択する**のダイアログで、生成したプロファイルを表す最新のプロファイルを選択します。

    ![先ほど生成したプロファイルを選択します。](media/select-profile-from-crm-dialog.png)

    > [!NOTE]
    > 取り込まれたプロファイルは、**設定** > **拡張** > **プラグイン プロファイル**に移動して **Dynamics 365 - カスタム** Web アプリケーションで管理できます。

1. **選択**をクリックしてダイアログを閉じます。
1. **アセンブリの場所**のフィールドで、省略記号 (**...**) ボタンをクリックして、デバッグしているワークフロー活動を含むアセンブリの場所を追加します。
1. Visual Studio でワークフロー活動プロジェクトを開きます。
1. ワークフロー活動の `Execute` メソッド内の行にブレークポイントを追加します。

    ![ブレークポイントの設定](media/set-breakpoint-in-workflow-activity.png)

1. **デバッグ** メニューから、**プロセスにアタッチ ...** を選択します。
1. `PluginRegistration.exe` のプロセスを検索します。

    > [!TIP]
    > 検索フィルターは、これをすばやく検索するのに役立ちます。 プロセスに割り当てられたプロセス ID (PID) はセッション毎に異なります。 PID は、**プラグイン トレース**の**プラグイン実行の再生**ダイアログに表示されます。

    ![プロセス ダイアログに Visual Studio を添付する](media/visual-studio-attach-to-process-dialog.png)

1. **添付**をクリックし、Visual Studio デバッガーをプロセス再生を実行する PRT アプリケーションに添付します。
1. PRT の**プラグイン実行の再生**ダイアログで、**実行の開始**ボタンをクリックします。

これで、Visual Studio を使用してコードを実行し、ワークフロー活動をデバッグできるようになりました。



### <a name="more-information"></a>詳細

[プラグインのデバッグ](../debug-plug-in.md)<br />
[チュートリアル: プラグインをデバッグする](../tutorial-debug-plug-in.md)
